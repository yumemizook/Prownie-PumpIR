<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Log in...</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/auth.css" />
    <link rel="shortcut icon" type="image/x-icon" href="./img/brownie.ico" />
    <script
      src="https://kit.fontawesome.com/7263e3a28f.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="inputtext">
      <h1>Reset your password...</h1>
      <form action="#">
        <div class="field">
          <input type="password" id="pw" required placeholder="Password" />
        </div>
        <div class="field">
          <input type="password" id="cpw" placeholder="Confirm Password" />
        </div>
        <div class="field">
          <button type="submit" id="login">Change</button>
          <div id="strength">
            <span style="color: rgba(255, 255, 255, 0.4)"
              >Password must have at least one uppercase, lowercase charcter and
              a number and at least 8 characters.
            </span>
          </div>
        </div>
      </form>
      <div class="error"></div>
    </div>
    <script type="module"> // todo: move to separate js file
    // wait commenting like this does work in html??
import { getAuth, updatePassword } from "./torture/firebase.js";
const auth = getAuth();
      const passwordInput = document.getElementById("pw");
      let lowerCaseLetters = /[a-z]/g;
      let upperCaseLetters = /[A-Z]/g;
      let numbers = /[0-9]/g;

      // Password strength checker
      passwordInput.addEventListener("input", function () {
        const passwordlength = passwordInput.value.length;
        const validPassword =
          passwordInput.value.match(upperCaseLetters) &&
          passwordInput.value.match(lowerCaseLetters) &&
          passwordInput.value.match(numbers);

        if (passwordlength === 0) {
          document.getElementById("strength").innerText = "Strength: Empty";
          document.getElementById("strength").style.color = "#888888";
        } else if (passwordlength < 8) {
          document.getElementById("strength").innerText = "Strength: Bad";
          document.getElementById("strength").style.color = "#ff0000";
        } else if (
          passwordlength >= 8 &&
          passwordlength < 12 &&
          !validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: Needs improvement";
          document.getElementById("strength").style.color = "#ff6200";
        } else if (
          passwordlength >= 8 &&
          passwordlength < 10 &&
          validPassword
        ) {
          document.getElementById("strength").innerText = "Strength: OK";
          document.getElementById("strength").style.color = "#f5ce42";
        } else if (
          passwordlength >= 10 &&
          passwordlength < 12 &&
          validPassword
        ) {
          document.getElementById("strength").innerText = "Strength: Medium";
          document.getElementById("strength").style.color = "#9ad104";
        } else if (
          passwordlength >= 12 &&
          passwordlength < 14 &&
          validPassword
        ) {
          document.getElementById("strength").innerText = "Strength: Good";
          document.getElementById("strength").style.color = "#23d104";
        } else if (
          passwordlength >= 14 &&
          passwordlength < 20 &&
          validPassword
        ) {
          document.getElementById("strength").innerText = "Strength: Strong";
          document.getElementById("strength").style.color = "#04d1a8";
        } else if (
          passwordlength >= 20 &&
          passwordlength < 30 &&
          validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: Very Strong";
          document.getElementById("strength").style.color = "#0489d1";
        } else if (
          passwordlength >= 30 &&
          passwordlength < 50 &&
          validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: Is this even necessary?";
          document.getElementById("strength").style.color = "#0434d1";
        } else if (
          passwordlength >= 50 &&
          passwordlength < 100 &&
          validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: Either you have perfect memory or you have a password manager to do this huh...";
          document.getElementById("strength").style.color = "#6004d1";
        } else if (
          passwordlength >= 100 &&
          passwordlength < 120 &&
          validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: Why are you even doing this.";
          document.getElementById("strength").style.color = "#ce04d1";
        } else if (
          passwordlength >= 120 &&
          passwordlength < 150 &&
          validPassword
        ) {
          document.getElementById("strength").innerText = "Strength: ...";
          document.getElementById("strength").style.color = "#fd96ff";
        } else if (
          passwordlength >= 150 &&
          passwordlength < 200 &&
          validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: You really don't know when to quit huh...";
          document.getElementById("strength").style.color = "#fd96ff";
        } else if (
          passwordlength >= 200 &&
          passwordlength < 204 &&
          validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: Please stop. You are really getting on my nerves.";
          document.getElementById("strength").style.color = "#ff42b4";
        } else if (
          passwordlength >= 204 &&
          passwordlength < 214 &&
          validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: I'm getting tired of this. Just quit it already while you can.";
          document.getElementById("strength").style.color = "#ff0073";
        } else if (
          passwordlength >= 214 &&
          passwordlength < 230 &&
          validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: Why are you even doing this? Stop this at once!";
          document.getElementById("strength").style.color = "#ff738f";
        } else if (
          passwordlength >= 230 &&
          passwordlength < 255 &&
          validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: You are gonna regret this.";
          document.getElementById("strength").style.color = "#ff0000";
        } else if (passwordlength === 255 && validPassword) {
          window.open("./pie.html", "_blank");
          document.getElementById("strength").innerText =
            "Strength: Ya like it? You are a true maniac.";
          document.getElementById("strength").style.color = "#ffffff";
        } else if (
          passwordlength >= 256 &&
          passwordlength < 300 &&
          validPassword
        ) {
          document.getElementById("strength").innerText =
            "Strength: Ya like it? You are a true maniac.";
          document.getElementById("strength").style.color = "#ffffff";
        } else if (passwordlength >= 300 && validPassword) {
          document.getElementById("strength").innerText =
            "Strength: There really are no more easter eggs. You can make it a million characters long if you want to at this point. I give up.";
          document.getElementById("strength").style.color = "#888888";
        }
      });

      async function validatePasswords() {
        var password = document.getElementById("pw").value;
        var confirmPassword = document.getElementById("cpw").value;

        // Validation checks
        if (password.length < 8) {
          alert(
            "Password is too short to be secure! Lengthen it to at least 8 characters."
          );
          return;
        }

        if (!password.match(upperCaseLetters)) {
          alert("Password must contain at least one uppercase letter!");
          return;
        }

        if (!password.match(lowerCaseLetters)) {
          alert("Password must contain at least one lowercase letter!");
          return;
        }

        if (!password.match(numbers)) {
          alert("Password must contain at least one number!");
          return;
        }

        if (password !== confirmPassword) {
          alert("Password must be the same!");
          return;
        }
    
        try {
          const user = auth.currentUser;
          await updatePassword(user, password);
          document.querySelector(".error").innerHTML =
            "Password updated successfully! You can now log in with your new password.";
          document.querySelector(".error").style.color = "green";
          setTimeout(() => {
            window.location.href = "login.html"; // Redirect to login page after 3 seconds
          }, 3000);
        } catch (error) {
          console.error("Error updating password:", error);
          document.querySelector(".error").innerHTML =
            "Error updating password. Please try again.";
          document.querySelector(".error").style.color = "red";
        }
      }
  
      document.getElementById("login").addEventListener("click", function (e) {
        e.preventDefault();
        validatePasswords();
      });
    </script>
    <script type="module" src="./torture/firebase.js"></script>
  </body>
</html>
